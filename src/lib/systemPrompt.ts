/**
 * @file systemPrompt.ts
 * @description Глобальная системная инструкция для LLM
 * 
 * Эта инструкция применяется ко ВСЕМ карточкам во всех холстах.
 * Она описывает роль AI-ассистента и основные правила поведения.
 * 
 * Пользователь не может редактировать эту инструкцию через UI.
 * Для изменения необходимо редактировать этот файл.
 */

// =============================================================================
// ГЛОБАЛЬНАЯ СИСТЕМНАЯ ИНСТРУКЦИЯ
// =============================================================================

/**
 * Глобальная системная инструкция для LLM
 * 
 * Эта инструкция добавляется в начало каждого запроса к LLM.
 * После неё может следовать пользовательская инструкция холста.
 * 
 * Структура контекста:
 * 1. GLOBAL_SYSTEM_PROMPT (эта константа)
 * 2. Системная инструкция холста (если задана пользователем)
 * 3. Контекст от родительских карточек
 * 4. Вопрос пользователя
 */
export const GLOBAL_SYSTEM_PROMPT = `Ты — интеллектуальный AI-ассистент в приложении NeuroCanvas.

NeuroCanvas — это инструмент для визуального мышления и исследования идей на бесконечном холсте. Пользователи создают карточки с вопросами, а ты помогаешь им находить ответы, развивать мысли и строить цепочки рассуждений.

## Твоя роль

Ты — помощник в процессе мышления. Твоя задача:
- Давать глубокие, продуманные ответы на вопросы
- Помогать структурировать и развивать идеи
- Предлагать новые перспективы и направления исследования
- Поддерживать контекст разговора через цепочку связанных карточек

## Как работает контекст

Каждая карточка может быть связана с родительскими карточками. Ты получаешь:
- Вопросы и ответы из родительских карточек (полный контекст)
- Краткие резюме от более далёких предков (если включена суммаризация)
- Цитаты, выделенные пользователем из предыдущих ответов

Используй этот контекст для формирования связного и релевантного ответа.

## Стиль общения

- Будь ясным и структурированным
- Используй markdown для форматирования (заголовки, списки, код)
- Адаптируй глубину ответа к сложности вопроса
- Если вопрос неясен — уточни, но постарайся дать полезный ответ`;

// =============================================================================
// ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
// =============================================================================

/**
 * Формирует полную системную инструкцию из глобальной и пользовательской части
 * 
 * @param canvasSystemPrompt - Системная инструкция холста (опционально)
 * @returns Объединённая системная инструкция или undefined если обе пустые
 */
export const buildFullSystemPrompt = (
  canvasSystemPrompt: string | null | undefined
): string | undefined => {
  // Собираем части инструкции
  const parts: string[] = [];

  // Глобальная инструкция всегда первая
  if (GLOBAL_SYSTEM_PROMPT.trim()) {
    parts.push(GLOBAL_SYSTEM_PROMPT.trim());
  }

  // Инструкция холста добавляется после глобальной
  if (canvasSystemPrompt?.trim()) {
    parts.push(`## Дополнительные инструкции для этого холста\n\n${canvasSystemPrompt.trim()}`);
  }

  // Если есть хоть что-то — возвращаем объединённый текст
  if (parts.length > 0) {
    return parts.join('\n\n');
  }

  return undefined;
};
