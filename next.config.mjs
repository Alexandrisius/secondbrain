/** 
 * @type {import('next').NextConfig} 
 * 
 * Конфигурация Next.js для NeuroCanvas
 * Настроена для работы как в браузере, так и в Electron
 * 
 * ВАЖНО: Используем standalone режим вместо static export,
 * т.к. приложение использует API routes для:
 * - Проксирования запросов к LLM API
 * - Сохранения данных в файловую систему
 * - Генерации эмбеддингов
 */
const nextConfig = {
  // ===========================================================================
  // STANDALONE BUILD ДЛЯ ELECTRON
  // ===========================================================================
  
  /**
   * output: 'standalone' создаёт минимальный Node.js сервер
   * который можно запустить внутри Electron.
   * 
   * Это позволяет сохранить все API routes и серверные функции.
   */
  output: 'standalone',
  
  /**
   * Отключаем оптимизацию изображений
   * Для простоты используем unoptimized изображения
   */
  images: {
    unoptimized: true,
  },
  
  // ===========================================================================
  // НАСТРОЙКИ ДЛЯ ELECTRON
  // ===========================================================================
  
  /**
   * Отключаем trailing slashes в URL
   */
  trailingSlash: false,
  
  // ===========================================================================
  // WEBPACK НАСТРОЙКИ
  // ===========================================================================
  
  webpack: (config, { isServer }) => {
    // Не модифицируем серверный webpack
    if (isServer) return config;
    
    /**
     * Fallback для Node.js модулей которые не работают в браузере
     * Electron preload скрипт обрабатывает эти модули,
     * но webpack должен знать что их нельзя бандлить
     */
    config.resolve.fallback = {
      ...config.resolve.fallback,
      fs: false,
      path: false,
      os: false,
      crypto: false,
    };
    
    return config;
  },
};

export default nextConfig;
